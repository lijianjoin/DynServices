<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">

    <changeSet author="ismart2" id="master-data-available-routines-v0.0.5">

        <!-- add workplace type for each routine, that the routine can be executed on-->
        <addColumn schemaName="available_routines"
                   tableName="available_routines">
            <column name="workplace_type_id" type="uuid">
                <constraints primaryKey="false"/>
            </column>
        </addColumn>

        <update tableName="available_routines" schemaName="available_routines">
            <column name="workplace_type_id" value="214bd598-affe-4137-ae06-8e9794df4539"/>
            <where>workplace_type_id IS NULL</where>
        </update>

        <addNotNullConstraint schemaName="available_routines"
                              tableName="available_routines"
                              columnName="workplace_type_id"
                              columnDataType="uuid"/>

        <!-- update values for TC Box related routines -->
        <update tableName="available_routines" schemaName="available_routines">
            <column name="workplace_type_id" value='7cb72de2-8b20-4d62-b9f1-44f5720e5d80'/>
            <where>name = 'ADJUST_TEMPERATURE_COMPENSATION'</where>
        </update>
        <update tableName="available_routines" schemaName="available_routines">
            <column name="workplace_type_id" value='7cb72de2-8b20-4d62-b9f1-44f5720e5d80'/>
            <where>name = 'CHECK_TEMPERATURE_COMPENSATION'</where>
        </update>

        <!-- add foreign key to the workplace type table -->
        <addForeignKeyConstraint baseTableSchemaName="available_routines"
                                 baseTableName="available_routines"
                                 baseColumnNames="workplace_type_id"
                                 constraintName="fk_available_routines_workplace_type_id"
                                 referencedTableName="workplace_type"
                                 referencedColumnNames="id"
                                 referencedTableSchemaName="workplace_schema"/>

    </changeSet>
</databaseChangeLog>